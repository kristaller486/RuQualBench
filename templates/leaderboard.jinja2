<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuQualBench Leaderboard </title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –§–∏–∫—Å –º–µ—Å—Ç–∞ –ø–æ–¥ –∏–∫–æ–Ω–∫—É –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ "–¥—ë—Ä–≥–∞–Ω–∏—è" –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
        th .sort-toggle {
            width: 16px;
            height: 16px;
            line-height: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            margin-left: 6px;
            position: relative;
        }
        th .sort-toggle svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 14px;
            height: 14px;
            transition: opacity 0.15s ease;
            /* fill: currentColor; // —É–∂–µ –∑–∞–¥–∞–Ω–æ inline, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –º–µ—à–∞–µ—Ç */
        }
        /* –ó–∞–ø—Ä–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å–∞ —Ç–µ–∫—Å—Ç–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∏ –ª—ë–≥–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ */
        thead th{ white-space:nowrap; }
        thead th .sort-toggle{ top:1px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>RuQualBench Leaderboard <span class="frog">üê∏</span></h1>
            <p class="subtitle">–ë–µ–Ω—á–º–∞—Ä–∫ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –¥–ª—è LLM</p>
            <div class="view-toggle" role="group" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞">
                <button class="toggle-btn is-active" data-mode="table" type="button">–¢–∞–±–ª–∏—Ü–∞</button>
                <button class="toggle-btn" data-mode="cards" type="button">–ö–∞—Ä—Ç–æ—á–∫–∏</button>
            </div>
        </header>
        
        <div class="leaderboard">
            <div class="table-wrap">
                <table>
                <thead>
                    <tr>
                        <th class="sticky-0" data-col="0" data-type="num"># 
                            <button class="sort-toggle" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" data-state="off" style="border:none;background:none;cursor:pointer;margin-left:6px;display:inline-flex;align-items:center;vertical-align:middle;padding:0;">
                                <svg class="icon-up" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 9.97H11.03V18.89L13.04 18.92V9.97H17.03L12.03 4.97Z" /></svg>
                                <svg class="icon-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 13.92H11.03V5L13.04 4.97V13.92H17.03L12.03 18.92Z" /></svg>
                            </button>
                        </th>
                        <th class="sticky-1" data-col="1" data-type="str">–ú–æ–¥–µ–ª—å 
                            <button class="sort-toggle" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" data-state="off" style="border:none;background:none;cursor:pointer;margin-left:6px;display:inline-flex;align-items:center;vertical-align:middle;padding:0;">
                                <svg class="icon-up" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 9.97H11.03V18.89L13.04 18.92V9.97H17.03L12.03 4.97Z" /></svg>
                                <svg class="icon-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 13.92H11.03V5L13.04 4.97V13.92H17.03L12.03 18.92Z" /></svg>
                            </button>
                        </th>
                        <th data-col="2" data-type="num">–ö—Ä–∏—Ç–∏—á–Ω—ã–µ/1000 
                            <button class="sort-toggle" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" data-state="off" style="border:none;background:none;cursor:pointer;margin-left:6px;display:inline-flex;align-items:center;vertical-align:middle;padding:0;">
                                <svg class="icon-up" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 9.97H11.03V18.89L13.04 18.92V9.97H17.03L12.03 4.97Z" /></svg>
                                <svg class="icon-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 13.92H11.03V5L13.04 4.97V13.92H17.03L12.03 18.92Z" /></svg>
                            </button>
                        </th>
                        <th data-col="3" data-type="num">–û–±—ã—á–Ω—ã–µ/1000 
                            <button class="sort-toggle" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" data-state="off" style="border:none;background:none;cursor:pointer;margin-left:6px;display:inline-flex;align-items:center;vertical-align:middle;padding:0;">
                                <svg class="icon-up" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 9.97H11.03V18.89L13.04 18.92V9.97H17.03L12.03 4.97Z" /></svg>
                                <svg class="icon-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 13.92H11.03V5L13.04 4.97V13.92H17.03L12.03 18.92Z" /></svg>
                            </button>
                        </th>
                        <th data-col="4" data-type="num">–î–æ–ø./1000 
                            <button class="sort-toggle" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" data-state="off" style="border:none;background:none;cursor:pointer;margin-left:6px;display:inline-flex;align-items:center;vertical-align:middle;padding:0;">
                                <svg class="icon-up" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 9.97H11.03V18.89L13.04 18.92V9.97H17.03L12.03 4.97Z" /></svg>
                                <svg class="icon-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 13.92H11.03V5L13.04 4.97V13.92H17.03L12.03 18.92Z" /></svg>
                            </button>
                        </th>
                        <th class="score-col" data-col="5" data-type="num">–ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ—à–∏–±–æ–∫ 
                            <button class="sort-toggle" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" data-state="off" style="border:none;background:none;cursor:pointer;margin-left:6px;display:inline-flex;align-items:center;vertical-align:middle;padding:0;">
                                <svg class="icon-up" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 9.97H11.03V18.89L13.04 18.92V9.97H17.03L12.03 4.97Z" /></svg>
                                <svg class="icon-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 13.92H11.03V5L13.04 4.97V13.92H17.03L12.03 18.92Z" /></svg>
                            </button>
                        </th>
                        <th data-col="6" data-type="num">–í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤ 
                            <button class="sort-toggle" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å" data-state="off" style="border:none;background:none;cursor:pointer;margin-left:6px;display:inline-flex;align-items:center;vertical-align:middle;padding:0;">
                                <svg class="icon-up" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 9.97H11.03V18.89L13.04 18.92V9.97H17.03L12.03 4.97Z" /></svg>
                                <svg class="icon-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:14px;height:14px;display:none;fill:currentColor;"><path d="M7.03 13.92H11.03V5L13.04 4.97V13.92H17.03L12.03 18.92Z" /></svg>
                            </button>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in leaderboard %}
                    <tr data-model="{{ entry.original_model }}">
                        <td class="rank mono sticky-0" data-label="#">#{{ loop.index }}</td>
                        <td class="model-name sticky-1" data-label="–ú–æ–¥–µ–ª—å">{{ entry.model }}</td>
                        <td class="num mono" data-label="–ö—Ä–∏—Ç–∏—á–Ω—ã–µ/1000">
                            {% if entry.critical_se %}
                            {{ "%.2f"|format(entry.critical) }} ¬± {{ "%.2f"|format(entry.critical_se) }}
                            {% else %}
                            {{ "%.2f"|format(entry.critical) }}
                            {% endif %}
                        </td>
                        <td class="num mono" data-label="–û–±—ã—á–Ω—ã–µ/1000">
                            {% if entry.mistakes_se %}
                            {{ "%.2f"|format(entry.mistakes) }} ¬± {{ "%.2f"|format(entry.mistakes_se) }}
                            {% else %}
                            {{ "%.2f"|format(entry.mistakes) }}
                            {% endif %}
                        </td>
                        <td class="num mono" data-label="–î–æ–ø./1000">
                            {% if entry.additional_se %}
                            {{ "%.2f"|format(entry.additional) }} ¬± {{ "%.2f"|format(entry.additional_se) }}
                            {% else %}
                            {{ "%.2f"|format(entry.additional) }}
                            {% endif %}
                        </td>
                        <td data-label="–ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ—à–∏–±–æ–∫">
                            <div class="score-cell">
                                <div class="progress-bar">
                                    {% set ratio = (entry.total / max_score) if max_score > 0 else 0 %}
                                    {% set bar_width = (1 - ratio) * 100 %}
                                    {% set bar_width = 100 if bar_width > 100 else (0 if bar_width < 0 else bar_width) %}
                                    <div class="progress-fill" style="width: {{ bar_width }}%"></div>
                                </div>
                                <span class="score-value">
                                    {% if entry.total_se %}
                                    {{ "%.2f"|format(entry.total) }} ¬± {{ "%.2f"|format(entry.total_se) }}
                                    {% else %}
                                    {{ "%.2f"|format(entry.total) }}
                                    {% endif %}
                                </span>
                            </div>
                        </td>
                        <td class="num mono" data-label="–í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤">{{ "{:,}".format(entry.tokens) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        
        <div class="legend">
            <p>
                <p>–ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞, –ø–æ–¥—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –Ω–∞ 1000 —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–≤–µ—Ç–∞: </p>
                <p>"–ö—Ä–∏—Ç–∏—á–Ω—ã–µ" - –≥—Ä—É–±—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è (–ø—Ä–æ–±–ª–µ–º—ã –≤ —Å–æ–≥–ª–∞–≤—Å–æ–≤–∞–Ω–∏–∏ —Å–ª–æ–≤, –≤—Å—Ç–∞–≤–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö, –Ω–∞–∏–±–æ–ª–µ–µ –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–¥—É–º–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞);</p>
                <p>"–û–±—ã—á–Ω—ã–µ" - –∑–∞–º–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ (–∫–∞–ª—å–∫–∏, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∏ —Ç.–ø.);</p>
                <p>"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ" - –º–∞–ª–æ–∑–Ω–∞—á–∏–º—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è, –ø–æ—á—Ç–∏ –Ω–µ –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å.</p>
            </p>
            <p>
                –ó–Ω–∞—á–µ–Ω–∏—è –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ 1000 —Ç–æ–∫–µ–Ω–æ–≤ o200k_base —Ç–µ–∫—Å—Ç–∞; "¬±" - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ (SE) –ø–æ —Å–µ—Ä–∏–∏ –ø—Ä–æ–≥–æ–Ω–æ–≤, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–æ–≤ –±—ã–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ.
                –ß–µ–º –º–µ–Ω—å—à–µ "–ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ—à–∏–±–æ–∫", —Ç–µ–º –ª—É—á—à–µ.
            </p>
            <p>
                "–ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ—à–∏–±–æ–∫" - –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞: –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ —É–º–Ω–æ–∂–∞—é—Ç—Å—è –Ω–∞ 2, –æ–±—ã—á–Ω—ã–µ - –Ω–∞ 1, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ - –Ω–∞ 0.5; —Å—É–º–º–∞ –Ω–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 1000 —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–≤–µ—Ç–∞.
            </p>
            <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è Gemini 2.5 Flash Lite –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–≤—ã—à–µ–Ω—ã–º–∏. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è temperature=0, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ. Recomend params - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –º–æ–¥–µ–ª–∏.</p>
        </div>
        <p class="info-text">–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –¥–æ–±–∞–≤–∏–ª —Ç—É –∏–ª–∏ –∏–Ω—É—é –º–æ–¥–µ–ª—å –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥ - –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ—Ç–∫—Ä—ã—Ç—å issue/pull request –Ω–∞ Github.</p>
        <p class="info-text">
            –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ update_time }} | –í—Å–µ–≥–æ –º–æ–¥–µ–ª–µ–π: {{ leaderboard|length }} | <a href="https://github.com/kristaller486/RuQualBench">GitHub</a> | <a href="https://t.me/krists">Telegram</a>
        </p>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const h1 = document.querySelector('h1');
            const frogSpan = document.querySelector('.frog');
            let isKva = false;
            
            frogSpan.style.cursor = 'pointer';
            
            frogSpan.addEventListener('click', function() {
                isKva = !isKva;
                const textNode = h1.firstChild;
                textNode.textContent = isKva ? 'Ru–ö–≤–∞lBench Leaderboard ' : 'RuQualBench Leaderboard ';
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.querySelector('.leaderboard table');
            if (!table || !table.tHead || !table.tBodies.length) return;

            const thead = table.tHead;
            const tbody = table.tBodies[0];

            // –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–æ–∫, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–µ—Ä–Ω—É—Ç—å "–≤—ã–∫–ª—é—á–µ–Ω–æ"
            Array.from(tbody.querySelectorAll('tr')).forEach((r, i) => r.dataset.initIndex = i);

            function parseNumeric(text) {
                if (!text) return NaN;
                let base = text.split('¬±')[0];
                base = base.replace(/[^0-9\.\-]/g, '');
                const num = parseFloat(base);
                return isNaN(num) ? NaN : num;
            }

            function getCellValue(row, col, type) {
                const td = row.children[col];
                if (!td) return type === 'num' ? NaN : '';
                if (type === 'num') {
                    let text;
                    // –î–ª—è "–ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ—à–∏–±–æ–∫" –±–µ—Ä—ë–º —á–∏—Å–ª–æ –∏–∑ span.score-value
                    if (col === 5) {
                        const sv = td.querySelector('.score-value');
                        text = sv ? sv.textContent : td.textContent;
                    } else {
                        text = td.textContent;
                    }
                    return parseNumeric(text);
                } else {
                    return td.textContent.trim().toLowerCase();
                }
            }

            function resort(col, type, state) {
                const rows = Array.from(tbody.querySelectorAll('tr'));
                if (state === 'off') {
                    rows.sort((a, b) => (parseInt(a.dataset.initIndex, 10) - parseInt(b.dataset.initIndex, 10)));
                } else {
                    const dir = state === 'asc' ? 1 : -1;
                    rows.sort((r1, r2) => {
                        const v1 = getCellValue(r1, col, type);
                        const v2 = getCellValue(r2, col, type);
                        let cmp = 0;
                        if (type === 'num') {
                            if (isNaN(v1) && isNaN(v2)) cmp = 0;
                            else if (isNaN(v1)) cmp = 1;
                            else if (isNaN(v2)) cmp = -1;
                            else cmp = v1 - v2;
                        } else {
                            cmp = v1.localeCompare(v2, 'ru');
                        }
                        return cmp * dir;
                    });
                }
                rows.forEach(r => tbody.appendChild(r));
                // –ü–µ—Ä–µ—Å—á—ë—Ç –∫–æ–ª–æ–Ω–∫–∏ "#"
                Array.from(tbody.querySelectorAll('tr')).forEach((r, idx) => {
                    const rankCell = r.children[0];
                    if (rankCell) rankCell.textContent = '#' + (idx + 1);
                });
            }

            function updateThIcon(th) {
                const state = th.dataset.state || 'off';
                const btn = th.querySelector('.sort-toggle');
                if (!btn) return;
                const up = btn.querySelector('.icon-up');
                const down = btn.querySelector('.icon-down');
                // –ù–µ —Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ü–µ–ª–∏–∫–æ–º ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–¥–≤–∏–≥–æ–≤
                if (up) {
                    up.style.display = 'block';
                    up.style.opacity = (state === 'asc') ? '1' : '0';
                }
                if (down) {
                    down.style.display = 'block';
                    // –í "off" –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–µ–¥–Ω—É—é –≤–Ω–∏–∑-—Å—Ç—Ä–µ–ª–∫—É –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
                    down.style.opacity = (state === 'off') ? '0.35' : (state === 'desc' ? '1' : '0');
                }
            }

            function clearOtherStates(activeTh) {
                thead.querySelectorAll('th[data-col]').forEach(th => {
                    if (th !== activeTh) {
                        th.dataset.state = 'off';
                        updateThIcon(th);
                    }
                });
            }

            thead.querySelectorAll('th[data-col]').forEach(th => {
                th.dataset.state = 'off';
                updateThIcon(th);
                const btn = th.querySelector('.sort-toggle');
                if (!btn) return;
                btn.addEventListener('click', () => {
                    const current = th.dataset.state || 'off';
                    const next = current === 'off' ? 'desc' : (current === 'desc' ? 'asc' : 'off');
                    clearOtherStates(th);
                    th.dataset.state = next;
                    updateThIcon(th);
                    const col = parseInt(th.getAttribute('data-col'), 10);
                    const type = th.getAttribute('data-type') || 'str';
                    resort(col, type, next);
                });
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            const root = document.body;
            const btns = document.querySelectorAll('.view-toggle .toggle-btn');
            function setMode(mode){
                if(mode === 'cards'){
                    root.classList.add('cards-mode');
                }else{
                    root.classList.remove('cards-mode');
                }
                btns.forEach(b => b.classList.toggle('is-active', b.dataset.mode === mode));
            }
            const preferCards = window.matchMedia && window.matchMedia('(max-width: 640px)').matches;
            setMode(preferCards ? 'cards' : 'table');
            btns.forEach(b => b.addEventListener('click', () => setMode(b.dataset.mode)));
        });
    </script>
</body>
</html>
